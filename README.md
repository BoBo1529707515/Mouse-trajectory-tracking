# 用于跟踪小鼠轨迹的方案,持续更新中  
## 第八版： 遇到的问题请参见"常见问题 (Troubleshooting).md"
## 步骤 1: 运行参数选取  
首先运行参数选取，并调整各个参数显示出小鼠为白色的情况并记录，随后我们将对应的参数输入“正式识别”部分中的参数    
## 步骤 2: 选择分析的起始帧  
运行"正式识别,py"的界面: 程序会弹出一个名为 "Step 0: Select Start Frame" 的窗口，窗口下方有一个滑块。  
操作:  
拖动滑块，视频画面会实时更新。请找到您希望正式开始分析的那一帧画面。  
确认后，用鼠标点击一下该窗口，然后按下键盘上的 c 键或 Enter 键。  
结果: 该窗口关闭，程序将从您选择的这一帧开始后续所有分析。  
## 步骤 3: 选择不规则兴趣区域 (ROI)  
界面: 程序会弹出第二个窗口 "Step 1: Select Irregular ROIs"，背景是您刚刚选择的起始帧。  

操作:  

绘制: 在窗口中用鼠标左键点击，定义一个多边形的各个顶点。程序会自动将顶点连接起来。  
保存当前ROI: 当一个多边形区域绘制完成后，按下键盘上的 n 键。该区域会被蓝色线条框出并编号，然后您可以开始绘制下一个ROI。  
重置: 如果任何时候画错了，可以按下 r 键，所有已选的ROI都会被清空，您可以重新开始绘制。  
完成选择 (重要！):  
在您画完所有需要的ROI后，请务必先【用鼠标左键点击一下 "Step 1" 窗口的任意位置】以确保它处于激活状态。然后，再按下键盘上的 c 键或 Enter 键。  

结果: ROI选择窗口关闭，程序正式进入后台全速处理阶段。您会在命令行看到一个实时更新的进度条。  
## 理解输出文件
处理完成后，程序会在视频所在目录下创建一个与视频同名的文件夹。所有的输出结果都在这个文件夹里。  

tracked_video.mp4  

内容: 带有追踪标记的视频。您选择的ROI会用蓝色框标出，被追踪到的物体会有一个绿色的圆圈。视频左上角显示的是从分析起点开始的相对时间。  
用途: 直观地检查追踪效果是否准确。  
detailed_trajectory_pixels.csv  

内容: 最核心的原始数据文件，记录了每一帧的详细信息。  
列说明:  
frame_number: 视频的绝对帧号。  
video_real_time_sec: 视频的绝对时间（从视频0:00开始）。  
analysis_relative_time_sec: 分析的相对时间（从您选择的起点开始）。  
roi_id: 物体当前所在的ROI编号。  
x_pixel, y_pixel: 物体中心的像素坐标。  
distance_pixels: 物体相比于上一帧在同一ROI内的移动距离。  
cumulative_distance_pixels: 物体在同一ROI内的累计移动距离。  
trajectory_plot_roi_X.png (X为ROI编号)  

内容: 为每个ROI单独生成的一张高清轨迹图。例如，如果您选择了3个ROI，就会有 ..._roi_1.png, ..._roi_2.png, ..._roi_3.png 三个文件。  
特点: 每个图都有独立的坐标轴，且坐标范围会自动缩放以匹配ROI的大小，清晰地展示了物体在该区域内的运动轨迹。  
用途: 可直接用于报告、论文或演示文稿。  
summary_roi_X_pixels.csv (X为ROI编号)  

内容: 秒级运动总结报告。记录了在每个ROI内，每一秒结束时物体的累计运动距离。  
用途: 快速评估不同时间段内的活动强度。  
## 第五版：  
更新了多框选择和文件信息汇总，现在你可以在对应的文件夹中获得完整的信息。同时支持多个框内的分析运行脚本：会弹出一个 "1. Select ROIs" 窗口。  
画框：  
在窗口中按住鼠标左键并拖拽，画出第一个ROI。松开后，这个框会变成蓝色并被编号为 ROI 1。  
继续画第二个、第三个... 每个框都会被自动编号。  
如果画错了，可以按 r 键清空所有已选的框，然后重新开始。  
确认：当您画完所有需要的ROI后，按键盘上的 c 键或 Enter 键，选择窗口会关闭，追踪正式开始。  
处理：程序会全速在后台处理（因为 SHOW_VIDEO_PREVIEW 设为了 False），您会在命令行看到进度条。  
